<polymer-element name="g-mario" attributes="width height" extends="g-entity">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    <g-sprite id="sprite" src="assets/smb3-mario_sheet.png" animation="run-little" columns="15" rows="14">
      <g-animation name="run-little" period="250" type="linear" loops="5">
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="1" y="0"/>
      </g-animation>
      <g-animation name="grow" period="1000" type="linear">
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="0" y="2"/>
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="0" y="2"/>
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="0" y="2"/>
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="0" y="2"/>
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="0" y="2"/>
        <g-animation-state x="0" y="2"/>
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="0" y="2"/>
        <g-animation-state x="0" y="2"/>
        <g-animation-state x="0" y="0"/>
        <g-animation-state x="0" y="2"/>
        <g-animation-state x="0" y="2"/>
      </g-animation>
    </g-sprite>
    <g-state-machine>
      <g-state name="running"></g-state>
    </g-state-machine>
    <content></content>
  </template>
  <script>
    Polymer('g-mario', {
      ready: function () {
        this.super();

        var that = this;
        this.$.sprite.addEventListener('AnimationEnded', function (e) {
          var i = that.$.sprite._animationKeys.indexOf(that.$.sprite.getAttribute('animation'));
          i = (i + 1) % that.$.sprite._animationKeys.length;
          that.$.sprite.setAttribute('animation', that.$.sprite._animationKeys[i]);
        }, false);
      },
      onMoveLeft: function (event) {
      },
      onMoveRight: function (event) {
      },
      onJump: function (event) {
      },
      onRun: function (event) {
      },
      onUpdate: function (dt) {
        this.$.sprite.update(dt);
        this.super([dt]);
      },
      widthChanged: function (oldValue, newValue) {
        this.style.width = newValue + 'px';
        this.$.sprite.setAttribute('width', newValue);
      },
      heightChanged: function (oldValue, newValue) {
        this.style.height = newValue + 'px';
        this.$.sprite.setAttribute('height', newValue);
      }
    });
  </script>
</polymer-element>